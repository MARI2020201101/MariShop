<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
 <mapper namespace="com.mari.shop.mapper.OrderItemMapper"> 
	
	 <resultMap type="com.mari.shop.domain.OrderItem" id="orderItemMap">
	 	<id column="ORDER_ITEM_ID" property="orderItemId"/>
		<result column="COUNT" property="count"/>
		<result column="TOTAL_PRICE" property="totalPrice"/>
		<result column="PRODUCT_ID" property="productId"/>
		<result column="USER_ID" property="userId"/>
	 </resultMap>
	 
 	<resultMap type="com.mari.shop.domain.Product" id="productMap">
		<id column="PRODUCT_ID" property="productId"/>
		<result column="DETAIL" property="detail"/>
		<result column="IMG" property="img"/>
		<result column="PRICE" property="price"/>
		<result column="PRODUCT_NAME" property="productName"/>
		<result column="STOCK" property="stock"/>
		<result column="CATEGORY_ID" property="categoryId"/>
	</resultMap>
	<resultMap type="com.mari.shop.domain.User" id="userMap">
		<id column="USER_ID" property="userId"/>
		<result column="ADDRESS1" property="address1"/>
		<result column="ADDRESS2" property="address2"/>
		<result column="EMAIL" property="email"/>
		<result column="PASSWORD" property="password"/>
		<result column="PHONE" property="phone"/>
		<result column="USERNAME" property="username"/>
		<result column="ROLE" property="role"/>
	</resultMap>
	<resultMap type="com.mari.shop.domain.Category" id="categoryMap">
		<id column="CATEGORY_ID" property="categoryId"/>
		<result column="CATEGORY_NAME" property="categoryName"/>
	</resultMap>
	
	<resultMap type="com.mari.shop.model.OrderItemJoinVO" id="itemJoinMap">
     <collection property="orderItem" resultMap="orderItemMap" ></collection>
     <collection property="product" resultMap="productMap" ></collection>
     <collection property="user" resultMap="userMap" ></collection>
     <collection property="category" resultMap="categoryMap" ></collection>
    </resultMap>
    
 <insert id ="insert" parameterType ="com.mari.shop.domain.OrderItem">
  insert into TBL_ORDERITEM(ORDER_ITEM_ID,COUNT,TOTAL_PRICE,PRODUCT_ID,USER_ID ) 
  					values(ORDER_ITEM_SEQ.NEXTVAL,#{count},#{totalPrice},#{productId},#{userId})
 </insert>
 <select id ="selectWithProduct" resultMap="itemJoinMap">
 
 select * from tbl_orderitem o 
    left outer join tbl_user u on o.user_id = u.user_id
    left outer join 
        (select * from tbl_product p left outer join tbl_category c on p.category_id = c.category_id)
    p on p.product_id = o.product_id
 
 </select>
  
</mapper>